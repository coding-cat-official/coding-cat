#!/bin/bash

set -e

OUTFILE="problems.js"
TMPFILE="$(mktemp).js"
echo "Building problem list in $TMPFILE ... "

write() {
    echo "$@" >> "$TMPFILE"
}

write "// THIS FILE IS AUTOGENERATED. DO NOT EDIT MANUALLY."
write ""

for f in * ; do
    [ ! -d "$f" ] && continue
    name="$(jq -r .meta.name "$f/problem.json")"
    write "import" "$name" "from './$f/problem.json';"
done

write "const problems = ["
for f in * ; do
    [ ! -d "$f" ] && continue
    name="$(jq -r .meta.name "$f/problem.json")"
    write "    $name,"
done
write "];"

write "export default problems;"

echo "Build succeeded. Overwriting $OUTFILE"
mv "$TMPFILE" "$OUTFILE"
